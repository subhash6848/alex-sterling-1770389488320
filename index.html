<script>
/* ==================== HEADER SCROLL ==================== */
const header = document.getElementById('header');
const menuIcon = document.getElementById('menu-icon');
const navbar = document.getElementById('navbar');

window.addEventListener('scroll', () => {
  header.classList.toggle('scrolled', window.scrollY > 100);
});

/* ==================== MENU TOGGLE ==================== */
menuIcon.addEventListener('click', () => {
  navbar.classList.toggle('active');
  menuIcon.classList.toggle('bx-x');
});

document.querySelectorAll('.navbar a').forEach(link => {
  link.addEventListener('click', () => {
    navbar.classList.remove('active');
    menuIcon.classList.remove('bx-x');
  });
});

/* ==================== ACTIVE NAV LINK ==================== */
const sections = document.querySelectorAll('section');
const navLinks = document.querySelectorAll('header nav a');

window.addEventListener('scroll', () => {
  let current = '';
  sections.forEach(section => {
    if (scrollY >= section.offsetTop - 150) {
      current = section.id;
    }
  });

  navLinks.forEach(link => {
    link.classList.toggle('active', link.getAttribute('href').includes(current));
  });
});

/* ==================== SMOOTH SCROLL ==================== */
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
  anchor.addEventListener('click', e => {
    e.preventDefault();
    const target = document.querySelector(anchor.getAttribute('href'));
    if (target) {
      window.scrollTo({
        top: target.offsetTop - 80,
        behavior: 'smooth'
      });
    }
  });
});

/* ==================== TYPED.JS ==================== */
new Typed('.text-animation span', {
  strings: [
    'Frontend Developer',
    'Backend Developer',
    'MERN Stack Developer',
    'Software Developer'
  ],
  typeSpeed: 80,
  backSpeed: 60,
  backDelay: 1500,
  loop: true
});

/* ==================== SKILL CIRCLE ANIMATION ==================== */
function animateSkills() {
  const circles = document.querySelectorAll('.skill-circle');

  const observer = new IntersectionObserver(entries => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        const circle = entry.target;
        const progress = circle.querySelector('.progress-circle');
        const value = circle.querySelector('.percentage-value');
        const percent = parseInt(circle.dataset.percent);
        const radius = 60;
        const circumference = 2 * Math.PI * radius;

        progress.style.strokeDasharray = circumference;
        progress.style.strokeDashoffset = circumference;

        setTimeout(() => {
          progress.style.strokeDashoffset =
            circumference - (percent / 100) * circumference;
        }, 100);

        let count = 0;
        const interval = setInterval(() => {
          value.textContent = count;
          if (count >= percent) clearInterval(interval);
          count++;
        }, 20);

        observer.unobserve(circle);
      }
    });
  }, { threshold: 0.5 });

  circles.forEach(c => observer.observe(c));
}

document.addEventListener('DOMContentLoaded', animateSkills);

/* ==================== CUSTOM CURSOR (FIXED) ==================== */
if (!window.matchMedia('(pointer: coarse)').matches) {
  const cursor = document.createElement('div');
  const dot = document.createElement('div');

  cursor.className = 'custom-cursor';
  dot.className = 'custom-cursor-dot';

  document.body.append(cursor, dot);

  let x = 0, y = 0, dx = 0, dy = 0;

  document.addEventListener('mousemove', e => {
    x = e.clientX;
    y = e.clientY;
  });

  function moveCursor() {
    dx += (x - dx) * 0.1;
    dy += (y - dy) * 0.1;
    cursor.style.left = `${dx}px`;
    cursor.style.top = `${dy}px`;
    dot.style.left = `${x}px`;
    dot.style.top = `${y}px`;
    requestAnimationFrame(moveCursor);
  }
  moveCursor();

  document.querySelectorAll(
    'a, button, input, textarea, .portfolio-box, .tech-item, .skill-item, .project-box'
  ).forEach(el => {
    el.addEventListener('mouseenter', () => {
      cursor.classList.add('cursor-hover');
      dot.classList.add('cursor-hover');
    });
    el.addEventListener('mouseleave', () => {
      cursor.classList.remove('cursor-hover');
      dot.classList.remove('cursor-hover');
    });
  });
}

/* ==================== THEME TOGGLE ==================== */
const themeToggle = document.getElementById('theme-toggle');
const themeIcon = document.getElementById('theme-icon');

const savedTheme = localStorage.getItem('theme') || 'dark';
document.documentElement.setAttribute('data-theme', savedTheme);
updateThemeIcon(savedTheme);

themeToggle.addEventListener('click', () => {
  const theme = document.documentElement.getAttribute('data-theme');
  const newTheme = theme === 'dark' ? 'light' : 'dark';
  document.documentElement.setAttribute('data-theme', newTheme);
  localStorage.setItem('theme', newTheme);
  updateThemeIcon(newTheme);
});

function updateThemeIcon(theme) {
  themeIcon.className = theme === 'dark' ? 'bx bx-moon' : 'bx bx-sun';
}

/* ==================== LOADER FIX (MAIN + FAILSAFE) ==================== */
window.addEventListener('load', () => {
  const loader = document.getElementById('loader');
  if (!loader) return;

  setTimeout(() => {
    loader.classList.add('fade-out');
    setTimeout(() => loader.remove(), 600);
  }, 500);
});

// ðŸ”¥ FAILSAFE (never trap user)
setTimeout(() => {
  const loader = document.getElementById('loader');
  if (loader) loader.remove();
}, 5000);

/* ==================== CONSOLE LOG ==================== */
console.log('%cðŸš€ Portfolio Loaded Successfully!',
  'color:#667eea;font-size:18px;font-weight:bold;');
</script>
